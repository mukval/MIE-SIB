# MIE-SIB. Homework #3. 

### 1. Histogram of time between flows.

File [tmp.flw](https://github.com/platomik/MIE-SIB/blob/master/homework3/tmp.flw "tmp.flw"). was generated by plugin Nfsen2R. It includes traffic flows for half-day interval. And looks like:

	DATE,SOURCE,DESTINATION,PROTO,SPORT,DPORT,INPUT,OUTPUT,DURATION,FLAGS
	2012-12-21 23:58:50.202,    173.45.67.98,   78.46.229.109,TCP  ,  4287,    80,       6,       0,    0.302,.AP.SF
	2012-12-21 23:58:50.202,   78.46.229.109,    173.45.67.98,TCP  ,    80,  4287,       7,       0,    0.302,.AP.SF
	2012-12-21 23:58:58.655,   78.46.229.109,    173.45.67.98,TCP  ,    80,  1139,       7,       0,    0.300,.AP.SF
	....

Let's build a histogram for time between adjacent flows in the file.

Import data from file to data matrix representation:

	x <- as.matrix(read.csv(file="/tmp/tmp.flw",head=TRUE,sep=","))

Create new element from 1st column that matrix. That is flows time:

	y=strptime(x[,1], "%Y-%m-%d %H:%M:%OS")
	
Now new element is created from differences between adjacent flow time:

	z<-as.table(diff(y))
	
Plot barhistogram for the values:

	barplot(z)
	
![](https://github.com/platomik/MIE-SIB/raw/master/homework3/p1.jpg)

**Question:** `Why do we have negative values?` 

**Answer:** Collector puts information about the transmission into the file when it is finished but this record will contain start time when transmission is started. It means traffic between two nodes contains many flows will be registered later than traffic between two nodes with less flows. When traffic is intensive the situation is more apparent.

In our case it would be better sort flows by registered time and draw a histogram again:

	z<-as.table(diff(sort(y)))
	
![](https://github.com/platomik/MIE-SIB/raw/master/homework3/p2.jpg)

**Note:** On the plot we can see two zones with small time intervals. They show intensive traffic in that time.

### 2. Pie chart graphing source ports

We should work now with file [sport.flw](https://github.com/platomik/MIE-SIB/blob/master/homework3/sport.flw "sport.flw"). It includes source ports,source IP addresses, number of flows. And looks like:
	DESTINATION,SPORT,FLOWS
	    78.46.238.74, 12014,    1
	   78.46.229.109, 56258,    1
	     78.47.45.78, 65225,    1
	   78.46.229.109, 56811,    1
	     78.46.244.6, 24722,    1
	   78.46.229.109, 49810,    2
	    94.25.128.69,    53,    2
	  125.255.41.123,    80,    7

First of all we should import file into data.frame element

	x<-read.csv(file="/tmp/sport.flw",head=TRUE,sep=",")

6588 elements in array `x` .

Then grouping records by the same port values:
	
	y<-aggregate(x['FLOWS'],by=x['SPORT'],sum)
	
Number of elements is decreased to 5463. Now change port name to **other** if number of flows is equal to **1**:

	y$SPORT[y$FLOWS==1]<-"other"
	
And group array again:

	z<-aggregate(y['FLOWS'],by=y['SPORT'],sum)	
	
Number of elements is 816. It is too much for pie diagram. And if we try to draw it we are going to get smth like:
	
	pie(z$FLOWS,z$SPORT)
	
![](https://github.com/platomik/MIE-SIB/raw/master/homework3/p3.jpg)

To achive more nicer pie diagram we should change the condition `joining ports with 1 flow to group other`. Let's put into `other` all ports with less than 100 flows. And draw chart again:

	y$SPORT[y$FLOWS<100]<-"other"
	z<-aggregate(y['FLOWS'],by=y['SPORT'],sum)
	pie(z$FLOWS,z$SPORT)

![](https://github.com/platomik/MIE-SIB/raw/master/homework3/p4.jpg)

The chart allows make conclusion that server has 3 open ports - web server, dns server and ntp server.

### 3. Pie chart graphing destination ports

The same procedure as above must be repeated to draw a chart for destination ports:

	x<-read.csv(file="/tmp/dport.flw",head=TRUE,sep=",")
	y<-aggregate(x['FLOWS'],by=x['DPORT'],sum)
	y$DPORT[y$FLOWS<100]<-"other"
	z<-aggregate(y['FLOWS'],by=y['DPORT'],sum)
	pie(z$FLOWS,z$DPORT)

![](https://github.com/platomik/MIE-SIB/raw/master/homework3/p5.jpg)

We may notice sendmail port on the chart. Server sends notifications from time to time.
